require=function t(e,s,i){function r(a,o){if(!s[a]){if(!e[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(n)return n(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var g=s[a]={exports:{}};e[a][0].call(g.exports,(function(t){return r(e[a][1][t]||t)}),g,g.exports,t,e,s,i)}return s[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&i(e,t,s);return r(e,t),e};Object.defineProperty(s,"__esModule",{value:!0});const a=n(t("./index"));window.p2pml||(window.p2pml={}),window.p2pml.hlsjs=a},{"./index":"p2p-media-loader-hlsjs"}],2:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Engine=void 0;const i=t("events"),r=t("p2p-media-loader-core"),n=t("./segment-manager"),a=t("./hlsjs-loader");class o extends i.EventEmitter{constructor(t={}){super(),this.loader=new r.HybridLoader(t.loader),this.segmentManager=new n.SegmentManager(this.loader,t.segments),Object.keys(r.Events).map((t=>r.Events[t])).forEach((t=>this.loader.on(t,((...e)=>this.emit(t,...e)))))}static isSupported(){return r.HybridLoader.isSupported()}createLoaderClass(){var t;const e=this;return(t=class{constructor(){this.load=async(t,e,s)=>{this.context=t,await this.impl.load(t,e,s)},this.abort=()=>{this.context&&this.impl.abort(this.context)},this.destroy=()=>{this.context&&this.impl.abort(this.context)},this.impl=new a.HlsJsLoader(e.segmentManager),this.stats={aborted:!1,retry:0,chunkCount:0,bwEstimate:0,parsing:{start:0,end:0},loading:{start:0,first:0,end:0},buffering:{start:0,first:0,end:0},loaded:0,total:0}}}).getEngine=()=>e,t}async destroy(){await this.segmentManager.destroy()}getSettings(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}getDetails(){return{loader:this.loader.getDetails()}}setPlayingSegment(t,e,s,i){this.segmentManager.setPlayingSegment(t,e,s,i)}setPlayingSegmentByCurrentTime(t){this.segmentManager.setPlayingSegmentByCurrentTime(t)}}s.Engine=o},{"./hlsjs-loader":3,"./segment-manager":4,events:"events","p2p-media-loader-core":"p2p-media-loader-core"}],3:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.HlsJsLoader=void 0;s.HlsJsLoader=class{constructor(t){this.segmentManager=t}async load(t,e,s){if(t.type)try{const e=await this.segmentManager.loadPlaylist(t.url);this.successPlaylist(e,t,s)}catch(e){this.error(e,t,s)}else if(t.frag)try{const e=await this.segmentManager.loadSegment(t.url,void 0!==t.rangeStart&&void 0!==t.rangeEnd&&t.rangeEnd-t.rangeStart?{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart}:void 0),{content:i}=e;void 0!==i&&setTimeout((()=>this.successSegment(i,e.downloadBandwidth,t,s)),0)}catch(e){setTimeout((()=>this.error(e,t,s)),0)}else console.warn("Unknown load request",t)}abort(t){this.segmentManager.abortSegment(t.url,void 0===t.rangeStart||void 0===t.rangeEnd?void 0:{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart})}successPlaylist(t,e,s){const i={aborted:!1,retry:0,chunkCount:0,bwEstimate:0,parsing:{start:0,end:0},loading:{start:0,first:0,end:0},buffering:{start:0,first:0,end:0},loaded:t.response.length,total:t.response.length};s.onSuccess({url:t.responseURL,data:t.response},i,e,void 0)}successSegment(t,e,s,i){const r={aborted:!1,retry:0,chunkCount:0,bwEstimate:0,parsing:{start:0,end:0},loading:{start:0,first:0,end:0},buffering:{start:0,first:0,end:0},loaded:t.byteLength,total:t.byteLength};i.onProgress&&i.onProgress(r,s,t,void 0),i.onSuccess({url:s.url,data:t},r,s,void 0)}error(t,e,s){s.onError(t,e,void 0)}}},{}],4:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SegmentManager=void 0;const i=t("p2p-media-loader-core"),r=t("m3u8-parser"),n={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0};s.SegmentManager=class{constructor(t,e={}){this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=t=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&l(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onSuccess(t.data.slice(0),t.downloadBandwidth),this.segmentRequest=null)},this.onSegmentError=(t,e)=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&l(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onError(e),this.segmentRequest=null)},this.onSegmentAbort=t=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&l(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onError("Loading aborted: internal abort"),this.segmentRequest=null)},this.settings=Object.assign(Object.assign({},n),e),this.loader=t,this.loader.on(i.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(i.Events.SegmentError,this.onSegmentError),this.loader.on(i.Events.SegmentAbort,this.onSegmentAbort)}getSettings(){return this.settings}processPlaylist(t,e,s){const i=new r.Parser;i.push(e),i.end();const n=new a(t,s,i.manifest);if(n.manifest.playlists){this.masterPlaylist=n;for(const[t,e]of this.variantPlaylists){const{streamSwarmId:s,found:i,index:r}=this.getStreamSwarmId(e.requestUrl);i?(e.streamSwarmId=s,e.streamId="V"+r.toString()):this.variantPlaylists.delete(t)}}else{const{streamSwarmId:e,found:s,index:i}=this.getStreamSwarmId(t);(s||null===this.masterPlaylist)&&(n.streamSwarmId=e,n.streamId=null===this.masterPlaylist?void 0:"V"+i.toString(),this.variantPlaylists.set(t,n),this.updateSegments())}}async loadPlaylist(t){const e=this.settings.assetsStorage;let s;if(void 0!==e){let i;i=this.getMasterSwarmId(),void 0===i&&(i=t.split("?")[0]);const r=await e.getAsset(t,void 0,i);void 0!==r?s={responseURL:r.responseUri,response:r.data}:(s=await this.loadContent(t,"text"),e.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t,masterSwarmId:i,requestUri:t,responseUri:s.responseURL,data:s.response}))}else s=await this.loadContent(t,"text");return this.processPlaylist(t,s.response,s.responseURL),s}async loadSegment(t,e){var s;const i=this.getSegmentLocation(t,e),r=l(e);if(!i){let e;const i=this.settings.assetsStorage;if(void 0!==i){let n,a=null===(s=this.masterPlaylist)||void 0===s?void 0:s.requestUrl;if(n=this.getMasterSwarmId(),void 0===n&&1===this.variantPlaylists.size){const t=this.variantPlaylists.values().next();t.done||(n=t.value.requestUrl.split("?")[0])}if(void 0===a&&1===this.variantPlaylists.size){const t=this.variantPlaylists.values().next();t.done||(a=t.value.requestUrl)}if(void 0!==n&&void 0!==a){const s=await i.getAsset(t,r,n);if(void 0!==s)e=s.data;else{const s=await this.loadContent(t,"arraybuffer",r);e=s.response,i.storeAsset({masterManifestUri:a,masterSwarmId:n,requestUri:t,requestRange:r,responseUri:s.responseURL,data:e})}}}if(void 0===e){e=(await this.loadContent(t,"arraybuffer",r)).response}return{content:e,downloadBandwidth:0}}const n=(i.playlist.manifest.mediaSequence?i.playlist.manifest.mediaSequence:0)+i.segmentIndex;if(this.playQueue.length>0){this.playQueue[this.playQueue.length-1].segmentSequence!==n-1&&(this.playQueue=[])}this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported");const a=new Promise(((s,r)=>{this.segmentRequest=new o(t,e,n,i.playlist.requestUrl,((t,e)=>s({content:t,downloadBandwidth:e})),(t=>r(t)))}));return this.playQueue.push({segmentUrl:t,segmentByteRange:e,segmentSequence:n}),this.loadSegments(i.playlist,i.segmentIndex,!0),a}setPlayingSegment(t,e,s,i){const r=this.playQueue.findIndex((s=>s.segmentUrl===t&&u(s.segmentByteRange,e)));r>=0&&(this.playQueue=this.playQueue.slice(r),this.playQueue[0].playPosition={start:s,duration:i},this.updateSegments())}setPlayingSegmentByCurrentTime(t){if(0===this.playQueue.length||!this.playQueue[0].playPosition)return;const e=this.playQueue[0].playPosition;e.start+e.duration-t<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}abortSegment(t,e){this.segmentRequest&&this.segmentRequest.segmentUrl===t&&u(this.segmentRequest.segmentByteRange,e)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}async destroy(){this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],void 0!==this.settings.assetsStorage&&await this.settings.assetsStorage.destroy(),await this.loader.destroy()}updateSegments(){if(!this.segmentRequest)return;const t=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByteRange);t&&this.loadSegments(t.playlist,t.segmentIndex,!1)}getSegmentLocation(t,e){for(const s of this.variantPlaylists.values()){const i=s.getSegmentIndex(t,e);if(i>=0)return{playlist:s,segmentIndex:i}}}async loadSegments(t,e,s){var i;const r=[],n=t.manifest.segments,a=null!==(i=t.manifest.mediaSequence)&&void 0!==i?i:0;let o=null,u=Math.max(0,this.playQueue.length-1);const g=this.getMasterSwarmId();for(let i=e;i<n.length&&r.length<this.settings.forwardSegmentCount;++i){const e=t.manifest.segments[i],n=t.getSegmentAbsoluteUrl(e.uri),d=e.byteRange,f=this.getSegmentId(t,a+i);r.push({id:f,url:n,masterSwarmId:void 0!==g?g:t.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t.requestUrl,streamId:t.streamId,sequence:(a+i).toString(),range:l(d),priority:u++}),s&&!o&&(o=f)}if(this.loader.load(r,t.streamSwarmId),o){const t=await this.loader.getSegment(o);t&&this.onSegmentLoaded(t)}}getSegmentId(t,e){return`${t.streamSwarmId}+${e}`}getMasterSwarmId(){const t=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==t?t:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}getStreamSwarmId(t){const e=this.getMasterSwarmId();if(this.masterPlaylist&&this.masterPlaylist.manifest.playlists&&e)for(let s=0;s<this.masterPlaylist.manifest.playlists.length;++s){if(new URL(this.masterPlaylist.manifest.playlists[s].uri,this.masterPlaylist.responseUrl).toString()===t)return{streamSwarmId:`${e}+V${s}`,found:!0,index:s}}return{streamSwarmId:null!=e?e:t.split("?")[0],found:!1,index:-1}}async loadContent(t,e,s){return new Promise(((i,r)=>{const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType=e,s&&n.setRequestHeader("Range",s),n.addEventListener("readystatechange",(()=>{4===n.readyState&&(n.status>=200&&n.status<300?i(n):r(n.statusText))}));const a=this.loader.getSettings().xhrSetup;a&&a(n,t),n.send()}))}};class a{constructor(t,e,s){this.requestUrl=t,this.responseUrl=e,this.manifest=s,this.streamSwarmId=""}getSegmentIndex(t,e){for(let s=0;s<this.manifest.segments.length;++s){const i=this.manifest.segments[s];if(t===this.getSegmentAbsoluteUrl(i.uri)&&u(i.byteRange,e))return s}return-1}getSegmentAbsoluteUrl(t){return new URL(t,this.responseUrl).toString()}}class o{constructor(t,e,s,i,r,n){this.segmentUrl=t,this.segmentByteRange=e,this.segmentSequence=s,this.playlistRequestUrl=i,this.onSuccess=r,this.onError=n}}function u(t,e){return void 0===t?void 0===e:void 0!==e&&t.length===e.length&&t.offset===e.offset}function l(t){if(void 0===t)return;const e=t.offset+t.length-1;return`bytes=${t.offset}-${e}`}},{"m3u8-parser":13,"p2p-media-loader-core":"p2p-media-loader-core"}],5:[function(t,e,s){e.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},e.exports.default=e.exports,e.exports.__esModule=!0},{}],6:[function(t,e,s){function i(){return e.exports=i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},e.exports.default=e.exports,e.exports.__esModule=!0,i.apply(this,arguments)}e.exports=i,e.exports.default=e.exports,e.exports.__esModule=!0},{}],7:[function(t,e,s){var i=t("./setPrototypeOf.js");e.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)},e.exports.default=e.exports,e.exports.__esModule=!0},{"./setPrototypeOf.js":9}],8:[function(t,e,s){e.exports=function(t){return t&&t.__esModule?t:{default:t}},e.exports.default=e.exports,e.exports.__esModule=!0},{}],9:[function(t,e,s){function i(t,s){return e.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e.exports.default=e.exports,e.exports.__esModule=!0,i(t,s)}e.exports=i,e.exports.default=e.exports,e.exports.__esModule=!0},{}],10:[function(t,e,s){(function(i){(function(){"use strict";var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(t){for(var e=(a=t,n.default.atob?n.default.atob(a):i.from(a,"base64").toString("binary")),s=new Uint8Array(e.length),r=0;r<e.length;r++)s[r]=e.charCodeAt(r);var a;return s};var n=r(t("global/window"));e.exports=s.default}).call(this)}).call(this,t("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":8,buffer:"buffer","global/window":12}],11:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var s=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(s,1),s>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var s=e.length,i=0;i<s;++i)e[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),n=e.length,a=0;a<n;++a)e[a].apply(this,r)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}();s.default=i,e.exports=s.default},{}],12:[function(t,e,s){(function(t){(function(){var s;s="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=s}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(t,e,s){
/*! @name m3u8-parser @version 4.6.0 @license Apache-2.0 */
"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t("@babel/runtime/helpers/inheritsLoose"),r=t("@videojs/vhs-utils/cjs/stream.js"),n=t("@babel/runtime/helpers/extends"),a=t("@babel/runtime/helpers/assertThisInitialized"),o=t("@videojs/vhs-utils/cjs/decode-b64-to-uint8-array.js");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l=u(i),g=u(r),d=u(n),f=u(a),c=u(o),h=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return l.default(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(g.default),p=String.fromCharCode(9),m=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),s={};return e[1]&&(s.length=parseInt(e[1],10)),e[2]&&(s.offset=parseInt(e[2],10)),s},y=function(t){for(var e,s=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},r=s.length;r--;)""!==s[r]&&((e=/([^=]*)=(.*)/.exec(s[r]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),i[e[0]]=e[1]);return i},b=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}l.default(e,t);var s=e.prototype;return s.push=function(t){var e,s,i=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,s){var i=s(t);return i===t?e:e.concat([i])}),[t]).forEach((function(t){for(var r=0;r<i.customParsers.length;r++)if(i.customParsers[r].call(i,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return s={type:"tag",tagType:"inf"},e[1]&&(s.duration=parseFloat(e[1])),e[2]&&(s.title=e[2]),void i.trigger("data",s);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"targetduration"},e[1]&&(s.duration=parseInt(e[1],10)),void i.trigger("data",s);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"version"},e[1]&&(s.version=parseInt(e[1],10)),void i.trigger("data",s);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return s={type:"tag",tagType:"media-sequence"},e[1]&&(s.number=parseInt(e[1],10)),void i.trigger("data",s);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return s={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(s.number=parseInt(e[1],10)),void i.trigger("data",s);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return s={type:"tag",tagType:"playlist-type"},e[1]&&(s.playlistType=e[1]),void i.trigger("data",s);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return s=d.default(m(e[1]),{type:"tag",tagType:"byterange"}),void i.trigger("data",s);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return s={type:"tag",tagType:"allow-cache"},e[1]&&(s.allowed=!/NO/.test(e[1])),void i.trigger("data",s);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(s={type:"tag",tagType:"map"},e[1]){var n=y(e[1]);n.URI&&(s.uri=n.URI),n.BYTERANGE&&(s.byterange=m(n.BYTERANGE))}i.trigger("data",s)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(s={type:"tag",tagType:"stream-inf"},e[1]){if(s.attributes=y(e[1]),s.attributes.RESOLUTION){var a=s.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),s.attributes.RESOLUTION=o}s.attributes.BANDWIDTH&&(s.attributes.BANDWIDTH=parseInt(s.attributes.BANDWIDTH,10)),s.attributes["PROGRAM-ID"]&&(s.attributes["PROGRAM-ID"]=parseInt(s.attributes["PROGRAM-ID"],10))}i.trigger("data",s)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return s={type:"tag",tagType:"media"},e[1]&&(s.attributes=y(e[1])),void i.trigger("data",s);if(e=/^#EXT-X-ENDLIST/.exec(t))i.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return s={type:"tag",tagType:"program-date-time"},e[1]&&(s.dateTimeString=e[1],s.dateTimeObject=new Date(e[1])),void i.trigger("data",s);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return s={type:"tag",tagType:"key"},e[1]&&(s.attributes=y(e[1]),s.attributes.IV&&("0x"===s.attributes.IV.substring(0,2).toLowerCase()&&(s.attributes.IV=s.attributes.IV.substring(2)),s.attributes.IV=s.attributes.IV.match(/.{8}/g),s.attributes.IV[0]=parseInt(s.attributes.IV[0],16),s.attributes.IV[1]=parseInt(s.attributes.IV[1],16),s.attributes.IV[2]=parseInt(s.attributes.IV[2],16),s.attributes.IV[3]=parseInt(s.attributes.IV[3],16),s.attributes.IV=new Uint32Array(s.attributes.IV))),void i.trigger("data",s);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return s={type:"tag",tagType:"start"},e[1]&&(s.attributes=y(e[1]),s.attributes["TIME-OFFSET"]=parseFloat(s.attributes["TIME-OFFSET"]),s.attributes.PRECISE=/YES/.test(s.attributes.PRECISE)),void i.trigger("data",s);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return s={type:"tag",tagType:"cue-out-cont"},e[1]?s.data=e[1]:s.data="",void i.trigger("data",s);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return s={type:"tag",tagType:"cue-out"},e[1]?s.data=e[1]:s.data="",void i.trigger("data",s);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return s={type:"tag",tagType:"cue-in"},e[1]?s.data=e[1]:s.data="",void i.trigger("data",s);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"skip"}).attributes=y(e[1]),s.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(s.attributes["SKIPPED-SEGMENTS"]=parseInt(s.attributes["SKIPPED-SEGMENTS"],10)),s.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(s.attributes["RECENTLY-REMOVED-DATERANGES"]=s.attributes["RECENTLY-REMOVED-DATERANGES"].split(p)),void i.trigger("data",s);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"part"}).attributes=y(e[1]),["DURATION"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=parseFloat(s.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=/YES/.test(s.attributes[t]))})),s.attributes.hasOwnProperty("BYTERANGE")&&(s.attributes.byterange=m(s.attributes.BYTERANGE)),void i.trigger("data",s);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"server-control"}).attributes=y(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=parseFloat(s.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=/YES/.test(s.attributes[t]))})),void i.trigger("data",s);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"part-inf"}).attributes=y(e[1]),["PART-TARGET"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=parseFloat(s.attributes[t]))})),void i.trigger("data",s);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"preload-hint"}).attributes=y(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(s.attributes.hasOwnProperty(t)){s.attributes[t]=parseInt(s.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";s.attributes.byterange=s.attributes.byterange||{},s.attributes.byterange[e]=s.attributes[t],delete s.attributes[t]}})),void i.trigger("data",s);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(s={type:"tag",tagType:"rendition-report"}).attributes=y(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){s.attributes.hasOwnProperty(t)&&(s.attributes[t]=parseInt(s.attributes[t],10))})),void i.trigger("data",s);i.trigger("data",{type:"tag",data:t.slice(4)})}}}else i.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},s.addParser=function(t){var e=this,s=t.expression,i=t.customType,r=t.dataParser,n=t.segment;"function"!=typeof r&&(r=function(t){return t}),this.customParsers.push((function(t){if(s.exec(t))return e.trigger("data",{type:"custom",data:r(t),customType:i,segment:n}),!0}))},s.addTagMapper=function(t){var e=t.expression,s=t.map;this.tagMappers.push((function(t){return e.test(t)?s(t):t}))},e}(g.default),E=function(t){var e={};return Object.keys(t).forEach((function(s){var i;e[(i=s,i.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[s]})),e},T=function(t){var e=t.serverControl,s=t.targetDuration,i=t.partTargetDuration;if(e){var r="#EXT-X-SERVER-CONTROL",n="holdBack",a="partHoldBack",o=s&&3*s,u=i&&2*i;s&&!e.hasOwnProperty(n)&&(e[n]=o,this.trigger("info",{message:r+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&e[n]<o&&(this.trigger("warn",{message:r+" clamping HOLD-BACK ("+e[n]+") to targetDuration * 3 ("+o+")"}),e[n]=o),i&&!e.hasOwnProperty(a)&&(e[a]=3*i,this.trigger("info",{message:r+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[a]+")."})),i&&e[a]<u&&(this.trigger("warn",{message:r+" clamping PART-HOLD-BACK ("+e[a]+") to partTargetDuration * 2 ("+u+")."}),e[a]=u)}},S=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new h,e.parseStream=new b,e.lineStream.pipe(e.parseStream);var s,i,r=f.default(e),n=[],a={},o=!1,u=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},g=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var p=0,m=0;return e.on("end",(function(){a.uri||!a.parts&&!a.preloadHints||(!a.map&&s&&(a.map=s),!a.key&&i&&(a.key=i),a.timeline||"number"!=typeof g||(a.timeline=g),e.manifest.preloadSegment=a)})),e.parseStream.on("data",(function(t){var e,f;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(a.byterange=e,e.length=t.length,"offset"in t||(t.offset=p)),"offset"in t&&(a.byterange=e,e.offset=t.offset),p=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(a.duration=t.duration),0===t.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:c.default(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(i.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,g=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){s={},t.uri&&(s.uri=t.uri),t.byterange&&(s.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||l,t.attributes?(a.attributes||(a.attributes={}),d.default(a.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var s=this.manifest.mediaGroups[t.attributes.TYPE];s[t.attributes["GROUP-ID"]]=s[t.attributes["GROUP-ID"]]||{},e=s[t.attributes["GROUP-ID"]],(f={default:/yes/i.test(t.attributes.DEFAULT)}).default?f.autoselect=!0:f.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(f.language=t.attributes.LANGUAGE),t.attributes.URI&&(f.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(f.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(f.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(f.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=f}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){g+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),a.dateTimeString=t.dateTimeString,a.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,T.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=t.data},"cue-out-cont":function(){a.cueOutCont=t.data},"cue-in":function(){a.cueIn=t.data},skip:function(){this.manifest.skip=E(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;o=!0;var s=this.manifest.segments.length,i=E(t.attributes);a.parts=a.parts||[],a.parts.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=m),m=i.byterange.offset+i.byterange.length);var r=a.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+r+" for segment #"+s,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,s){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+s+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=E(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),T.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,s=E(t.attributes),i=s.type&&"PART"===s.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(s),s.byterange&&(s.byterange.hasOwnProperty("offset")||(s.byterange.offset=i?m:0,i&&(m=s.byterange.offset+s.byterange.length)));var r=a.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+r+" for segment #"+e,t.attributes,["TYPE","URI"]),s.type)for(var n=0;n<a.preloadHints.length-1;n++){var o=a.preloadHints[n];o.type&&(o.type===s.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+r+" for segment #"+e+" has the same TYPE "+s.type+" as preload hint #"+n}))}},"rendition-report":function(){var e=E(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var s=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];o&&i.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+s,t.attributes,i)},"part-inf":function(){this.manifest.partInf=E(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),T.call(this,this.manifest)}}[t.tagType]||u).call(r)},uri:function(){a.uri=t.uri,n.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),i&&(a.key=i),a.timeline=g,s&&(a.map=s),m=0,a={}},comment:function(){},custom:function(){t.segment?(a.custom=a.custom||{},a.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(r)})),e}l.default(e,t);var s=e.prototype;return s.warnOnMissingAttributes_=function(t,e,s){var i=[];s.forEach((function(t){e.hasOwnProperty(t)||i.push(t)})),i.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+i.join(", ")})},s.push=function(t){this.lineStream.push(t)},s.end=function(){this.lineStream.push("\n"),this.trigger("end")},s.addParser=function(t){this.parseStream.addParser(t)},s.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(g.default);s.LineStream=h,s.ParseStream=b,s.Parser=S},{"@babel/runtime/helpers/assertThisInitialized":5,"@babel/runtime/helpers/extends":6,"@babel/runtime/helpers/inheritsLoose":7,"@videojs/vhs-utils/cjs/decode-b64-to-uint8-array.js":10,"@videojs/vhs-utils/cjs/stream.js":11}],"p2p-media-loader-hlsjs":[function(t,e,s){"use strict";
/**
 * @license Apache-2.0
 * Copyright 2018 Novage LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),r=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||i(e,t,s)};function n(t){t&&t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&a(t,t.config.loader.getEngine())}function a(t,e){t.on("hlsFragChanged",((t,s)=>{const i=s.frag,r=2!==i.byteRange.length?void 0:{offset:i.byteRange[0],length:i.byteRange[1]-i.byteRange[0]};e.setPlayingSegment(i.url,r,i.start,i.duration)})),t.on("hlsDestroying",(async()=>{await e.destroy()})),t.on("hlsError",((s,i)=>{if("bufferStalledError"===i.details){const s=void 0===t.media?t.el_:t.media;s&&e.setPlayingSegmentByCurrentTime(s.currentTime)}}))}Object.defineProperty(s,"__esModule",{value:!0}),s.initJwPlayer=s.initMediaElementJsPlayer=s.initVideoJsHlsJsPlugin=s.initVideoJsContribHlsJsPlayer=s.initFlowplayerHlsJsPlayer=s.initClapprPlayer=s.initHlsJsPlayer=s.version=void 0,s.version="0.7.0",r(t("./engine"),s),r(t("./segment-manager"),s),s.initHlsJsPlayer=n,s.initClapprPlayer=function(t){t.on("play",(()=>{const e=t.core.getCurrentPlayback();e._hls&&!e._hls._p2pm_linitialized&&(e._hls._p2pm_linitialized=!0,n(t.core.getCurrentPlayback()._hls))}))},s.initFlowplayerHlsJsPlayer=function(t){t.on("ready",(()=>{var e;return n(null!==(e=t.engine.hlsjs)&&void 0!==e?e:t.engine.hls)}))},s.initVideoJsContribHlsJsPlayer=function(t){t.ready((()=>{const e=t.tech_.options_;e&&e.hlsjsConfig&&e.hlsjsConfig.loader&&"function"==typeof e.hlsjsConfig.loader.getEngine&&a(t.tech_,e.hlsjsConfig.loader.getEngine())}))},s.initVideoJsHlsJsPlugin=function(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",((t,e)=>{e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&a(e,e.config.loader.getEngine())}))},s.initMediaElementJsPlayer=function(t){t.addEventListener("hlsFragChanged",(e=>{const s=t.hlsPlayer;if(s&&s.config&&s.config.loader&&"function"==typeof s.config.loader.getEngine){const t=s.config.loader.getEngine();if(e.data&&e.data.length>1){const s=e.data[1].frag,i=2!==s.byteRange.length?void 0:{offset:s.byteRange[0],length:s.byteRange[1]-s.byteRange[0]};t.setPlayingSegment(s.url,i,s.start,s.duration)}}})),t.addEventListener("hlsDestroying",(async()=>{const e=t.hlsPlayer;if(e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine){const t=e.config.loader.getEngine();await t.destroy()}})),t.addEventListener("hlsError",(e=>{const s=t.hlsPlayer;if(s&&s.config&&s.config.loader&&"function"==typeof s.config.loader.getEngine&&void 0!==e.data&&"bufferStalledError"===e.data.details){s.config.loader.getEngine().setPlayingSegmentByCurrentTime(s.media.currentTime)}}))},s.initJwPlayer=function(t,e){const s=setInterval((()=>{t.hls&&t.hls.config&&(clearInterval(s),Object.assign(t.hls.config,e),n(t.hls))}),200)}},{"./engine":2,"./segment-manager":4}]},{},[1]);
